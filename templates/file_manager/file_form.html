{% extends "file_manager/base_files.html" %}

{% block title %}üìÅ {{ title }}{% endblock %}
{% block files_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h3">{{ title }}</h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'file_manager:file_list' %}">–§–∞–π–ª—ã</a></li>
                <li class="breadcrumb-item active" aria-current="page">{{ title }}</li>
            </ol>
        </nav>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card shadow-sm">
            <div class="card-body">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    {% if file %}
                    <input type="hidden" name="file_id" value="{{ file.id }}">
                    {% endif %}
                    
                    <div class="mb-3">
                        <label for="id_title" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ *</label>
                        <input type="text" name="title" id="id_title" class="form-control" 
                               value="{{ form.title.value|default:"" }}" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="id_description" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea name="description" id="id_description" class="form-control" rows="3">{{ form.description.value|default:"" }}</textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label for="id_file" class="form-label">–§–∞–π–ª *</label>
                        <input type="file" name="file" id="id_file" class="form-control" required>
                        <div class="form-text">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: PDF, TXT, DOCX, XLSX, PPTX, JPG, PNG, MP4, MP3, ZIP</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="id_course" class="form-label">–ö—É—Ä—Å</label>
                        <select name="course" id="id_course" class="form-select">
                            <option value="">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</option>
                            {% for course in form.fields.course.queryset %}
                            <option value="{{ course.id }}" {% if form.course.value|add:"0" == course.id %}selected{% endif %}>
                                {{ course.title }}
                            </option>
                            {% endfor %}
                        </select>
                        <div class="form-text">–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ø—Ä–∏–≤—è–∑–∞—Ç—å —Ñ–∞–π–ª –∫ –∫—É—Ä—Å—É</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="id_visibility" class="form-label">–í–∏–¥–∏–º–æ—Å—Ç—å *</label>
                        <select name="visibility" id="id_visibility" class="form-select" required>
                            <option value="private" {% if form.visibility.value == 'private' %}selected{% endif %}>–ü—Ä–∏–≤–∞—Ç–Ω—ã–π - –¢–æ–ª—å–∫–æ —è</option>
                            <option value="shared" {% if form.visibility.value == 'shared' %}selected{% endif %}>–û–±—â–∏–π - –° –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</option>
                            <option value="public" {% if form.visibility.value == 'public' %}selected{% endif %}>–ü—É–±–ª–∏—á–Ω—ã–π - –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="id_shared_with" class="form-label">–û–±—â–∏–π –¥–æ—Å—Ç—É–ø</label>
                        <select name="shared_with" id="id_shared_with" class="form-select" multiple>
                            {% for user in form.fields.shared_with.queryset %}
                            <option value="{{ user.id }}" {% if user.id in form.shared_with.value|default:"" %}selected{% endif %}>
                                {{ user.username }}
                            </option>
                            {% endfor %}
                        </select>
                        <div class="form-text">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –æ–±—â–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞</div>
                    </div>
                    
                    {% if form.folder %}
                    <div class="mb-3">
                        <label for="id_folder" class="form-label">–ü–∞–ø–∫–∞</label>
                        <select name="folder" id="id_folder" class="form-select">
                            <option value="">–ù–µ—Ç (–∫–æ—Ä–Ω–µ–≤–∞—è –ø–∞–ø–∫–∞)</option>
                            {% for folder in form.fields.folder.queryset %}
                            <option value="{{ folder.id }}" {% if form.folder.value|add:"0" == folder.id %}selected{% endif %}>
                                {{ folder.title }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    {% endif %}
                    
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                        </button>
                        <a href="{% if file %}{% url 'file_manager:file_detail' file.id %}{% else %}{% url 'file_manager:file_list' %}{% endif %}" class="btn btn-secondary">
                            –û—Ç–º–µ–Ω–∞
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}